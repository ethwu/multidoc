\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{multidocument-relative-sectioning}[2023/03/21 Relative inclusion and sectioning.]

\RequirePackage{xparse}

% Track the document root. Needs to be redefined on a per-file level for subdocuments.
% Only defines if `\multidocument@root` has not already been defined.
\ProvideDocumentCommand{\multidocument@root}{ }{.}
% Input a subdocument using the relative path to the project root.
\NewDocumentCommand{\rinput}{ m }{\input{\multidocument@root/#1}}

% Relative sectioning commands.

% Counter tracking the current section nesting level.
\newcount\@rlevel
\@rlevel=1
% Input a subdocument with increased relative sectioning depth.
\NewDocumentCommand{\rsinput}{ m }{\advance\@rlevel by \@ne\rinput{#1}\advance\@rlevel by \m@ne}
\NewDocumentCommand{\setrlevel}{ m }{\@rlevel=#1}

\NewDocumentCommand{\rsection}{ sm }{
    \ifnum \@rlevel=0
        \IfBooleanTF#1{\chapter*{#2}}{\chapter{#2}}
    \else \ifnum \@rlevel=1
            \IfBooleanTF#1{\section*{#2}}{\section{#2}}
        \else \ifnum \@rlevel=2
                \IfBooleanTF#1{\subsection*{#2}}{\subsection{#2}}
            \else \ifnum \@rlevel=3
                    \IfBooleanTF#1{\subsubsection*{#2}}{\subsubsection{#2}}
                \else \ifnum \@rlevel=4
                        \IfBooleanTF#1{\paragraph*{#2}}{\paragraph{#2}}
                    \else
                        \IfBooleanTF#1{\subparagraph*{#2}}{\subparagraph{#2}}
                    \fi
                \fi
            \fi
        \fi
    \fi
}

\NewDocumentCommand{\rsubsection}{ sm }{
    \ifnum \@rlevel=0
        \IfBooleanTF#1{\section*{#2}}{\section{#2}}
    \else \ifnum \@rlevel=1
            \IfBooleanTF#1{\subsection*{#2}}{\subsection{#2}}
        \else \ifnum \@rlevel=2
                \IfBooleanTF#1{\subsubsection*{#2}}{\subsubsection{#2}}
            \else \ifnum \@rlevel=3
                    \IfBooleanTF#1{\paragraph*{#2}}{\paragraph{#2}}
                \else
                    \IfBooleanTF#1{\subparagraph*{#2}}{\subparagraph{#2}}
                \fi
            \fi
        \fi
    \fi
}

\NewDocumentCommand{\rsubsubsection}{ sm }{
    \ifnum \@rlevel=0
        \IfBooleanTF#1{\subsection*{#2}}{\subsection{#2}}
    \else \ifnum \@rlevel=1
            \IfBooleanTF#1{\subsubsection*{#2}}{\subsubsection{#2}}
        \else \ifnum \@rlevel=2
                \IfBooleanTF#1{\paragraph*{#2}}{\paragraph{#2}}
            \else
                \IfBooleanTF#1{\subparagraph*{#2}}{\subparagraph{#2}}
            \fi
        \fi
    \fi
}

\endinput
